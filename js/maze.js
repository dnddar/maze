(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.drawMap();else{var g=
new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c in this.list)if(c==this.autoWalkCount){var a=this.list[c];a.walk();a.draw()}this.autoWalkCount++;if(this.autoWalkCount>=g)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_20",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.drawMap();else{var g=
new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c in this.list)if(c==this.autoWalkCount){var a=this.list[c];a.walk();a.draw()}this.autoWalkCount++;if(this.autoWalkCount>=g)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_20",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_20",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_20",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(a>=g||a!=this.autoWalkCount)console.log(a);else{var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_20",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_40",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_60",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,5],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_60",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:16,columns:20,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:18,columns:24,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(12,18);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=this.img;c=new Yy.TileLayer(c);c.draw();
this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[10][17]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",sx:32,sy:0,width:32,height:32,
x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=[]},
initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_60",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:0,columns:0,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:0,columns:0,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],rows:15,columns:21,list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(this.rows,this.columns);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=
this.img;c=new Yy.TileLayer(c);c.draw();this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[this.rows-2][this.columns-1]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",
sx:32,sy:0,width:32,height:32,x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:5},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_60",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
window.Timer=f;g()})();
(function(){function g(){this.getId=function(){return this.id};this.getX=function(){return this.x};this.getY=function(){return this.y};this.getWidth=function(){return this.width};this.getHeight=function(){return this.height};this.getRect=function(){return[this.x,this.y,this.x+this.width,this.y+this.height]};this.draw=function(){this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)}}var c={isUndefined:function(a){return typeof a==="undefined"},
getRandom:function(a){return Math.ceil(Math.random()*a-1)},checkRect:function(a,b){var e=a[2]-a[0],f=a[3]-a[1],d=b[2]-b[0],h=b[3]-b[1],i=Math.abs(b[0]+d/2-(a[0]+e/2));e=Math.abs((e+d)/2);a=Math.abs(b[1]+h/2-(a[1]+f/2));f=Math.abs((f+h)/2);return i<=e&&a<=f?true:false}};c.timer={timer:null,init:function(){this.stop();this.start()},start:function(){var a=0;setInterval(function(){a++;c.event.notify("timer_20");a%2==0&&c.event.notify("timer_40");a%3==0&&c.event.notify("timer_60");a%4==0&&c.event.notify("timer_80");
a%5==0&&c.event.notify("timer_100");if(a==5)a=0},20)},stop:function(){this.timer&&clearInterval(this.timer)}};c.event={eventList:[],listen:function(a,b,e){if(typeof a=="undefined"||typeof b=="undefined")return false;if(!this.hadRegister(a,b)){this.eventList[a]=this.eventList[a]||[];this.eventList[a].push({func:b,context:e})}},hadRegister:function(a,b){a=this.eventList[a];if(typeof a=="undefined")return false;var e=false;for(var f in a)if(a[f].func===b){e=true;break}return e},notify:function(a,b){a=
this.eventList[a];if(typeof a=="undefined")return false;for(var e in a){var f=a[e];typeof f.context=="undefined"?f.func(b):f.func.apply(f.context,[b])}},bind:function(a,b,e){return function(f){f=e?[f].concat(e):[f];a.apply(b,f)}}};c.Layer=g;window.Yy=c})();(function(){function g(c){this.canvas=c.canvas;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.TileLayer=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=null,b=c.frameImgs||[],e=c.step||3,f=-1;this.walk=function(d){if(Game.isOver())return false;a||(a=d);if(a!=d)f=-1;a=d;switch(d){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect()))this.y-=e;else this.y=this.y+this.height>this.canvas.height?this.canvas.height-this.height:this.y;break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect()))this.x+=e;else this.x=this.x<0?0:this.x;break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect()))this.x-=e;else this.x=this.x+this.width>this.canvas.width?this.canvas.width-this.width:this.x;break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect()))this.y+=e;else this.y=this.y<0?0:this.y;break;default:return false}f=f>b[d].length-2?0:f+1;Game.checkEquip(this.getCheckRect());Game.checkGameIsOver(this.getCheckRect());Game.checkSpriteHit()};
this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]=this.x+5;d[1]=this.y+this.height-5;d[2]=this.x+this.width-5;return d};this.getDirection=function(){return a}}g.prototype=new Yy.Layer;Yy.SpriteMan=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0;var a=c.direction,b=c.frameImgs||[],e=c.step||3,f=-1;this.init=function(){};this.walk=function(){var d=false;switch(a){case "down":this.y+=e;if(Game.checkTileHit(this.getCheckRect())){this.y-=e;d=true}else if(this.y+this.height>this.canvas.height){this.y=this.canvas.height-this.height;d=true}break;case "left":this.x-=
e;if(Game.checkTileHit(this.getCheckRect())){this.x+=e;d=true}else if(this.x<0){this.x=0;d=true}break;case "right":this.x+=e;if(Game.checkTileHit(this.getCheckRect())){this.x-=e;d=true}else if(this.x+this.width>this.canvas.width){this.x=this.canvas.width-this.width;d=true}break;case "up":this.y-=e;if(Game.checkTileHit(this.getCheckRect())){this.y+=e;d=true}else if(this.y<0){this.y=0;d=true}break;default:return false}f=f>b[a].length-2?0:f+1;d&&this.changeDirection();Game.checkSpriteHit();return d};
this.changeDirection=function(){var d=["left","right","up","down"],h=[];for(var i in d){var j=d[i];j!=a&&h.push(j)}a=h[Yy.getRandom(h.length)]};this.setDirection=function(d){a=d};this.getDirection=function(){return a};this.draw=function(){f=f<0?0:f;var d=b[a];this.sx=d[f][0];this.sy=d[f][1];this.canvas.context.drawImage(this.img,this.sx,this.sy,this.width,this.height,this.x,this.y,this.width,this.height)};this.getCheckRect=function(){var d=this.getRect();d[0]+=5;d[1]+=5;d[2]-=5;d[2]-=5;return d}}
g.prototype=new Yy.Layer;Yy.SpriteTiger=g})();
(function(){var g={rows:0,columns:0,path:[],keyPath:[],matrix:new Array(this.rows),init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.keyPath=[];this.matrix=new Array(this.rows);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.matrix[0][0]=0;this.matrix[this.rows-1][this.columns-1]=1;this.generate();this.makeKeyPath()},generate:function(){for(var a=this.path,b=[0,0];b;){var e=this.getNextRandStep(b[0],b[1]);if(e){a.push(b);
this.matrix[e[0]][e[1]]=0;if(e[0]==this.rows-1&&e[1]==this.columns-1){a.push(e);break}else b=e}else{this.matrix[b[0]][b[1]]=-1;b=a.pop()}}},getNext:function(a,b,e){var f=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-1][b]==e&&f.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]==e&&f.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]==e&&f.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+
1])&&this.matrix[a][b+1]==e&&f.push([a,b+1]);if(f.length==0)return null;return f},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);var e=a[b];this.matrix[e[0]][e[1]]=2;return a[b]},makeKeyPath:function(){for(var a in this.path){var b=this.path[a],e=this.getNext(b[0],b[1],0);e&&e.length==2&&this.keyPath.push(b)}},getMatrix:function(){return this.matrix},getPath:function(){return this.path}},c={path:[],disturbPath:[],matrix:[],init:function(a,
b){this.matrix=a;this.path=b;this.disturbPath=[];this.generate()},generate:function(){var a=[];for(var b in this.path){a=this.path[b];for(var e=true;a;){var f=this.getNextRandStep(a[0],a[1]);if(!f)break;var d=this.matrix[f[0]][f[1]];this.matrix[f[0]][f[1]]=0;if(this.checkNextStep(f[0],f[1])){this.matrix[f[0]][f[1]]=0;this.disturbPath.push(f);a=f}else{this.matrix[f[0]][f[1]]=d;if(e)e=false;else break}}}},getNext:function(a,b){var e=[];this.matrix[a-1]&&!Yy.isUndefined(this.matrix[a-1][b])&&this.matrix[a-
1][b]!=0&&e.push([a-1,b]);this.matrix[a+1]&&!Yy.isUndefined(this.matrix[a+1][b])&&this.matrix[a+1][b]!=0&&e.push([a+1,b]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b-1])&&this.matrix[a][b-1]!=0&&e.push([a,b-1]);this.matrix[a]&&!Yy.isUndefined(this.matrix[a][b+1])&&this.matrix[a][b+1]!=0&&e.push([a,b+1]);if(e.length==0)return null;return e},getNextRandStep:function(a,b){a=this.getNext(a,b,1);if(!a)return null;b=a.length;b=Math.ceil(Math.random()*b-1);return a[b]},checkNextStep:function(a,b){a=
this.getNext(a,b,1);if(!a)return false;return a.length>=3?true:false},getDisturbPath:function(){return this.disturbPath}};Yy.mazeMap={rows:0,columns:0,path:[],matrix:[],init:function(a,b){this.rows=a;this.columns=b;this.path=[];this.matrix=[];g.init(this.rows/3,this.columns/3);for(a=0;a<this.rows;a++){this.matrix[a]=new Array(this.columns);for(b=0;b<this.columns;b++)this.matrix[a][b]=1}this.transToMap();this.makePath();c.init(this.matrix,this.path);this.makeTile()},transToMap:function(){var a=g.getPath(),
b=null;for(var e in a){var f=a[e];b&&this.updateMatirx(this.getDirt(b,f),b,f);b=f}},updateMatirx:function(a,b,e){var f=b[0]*3,d=b[1]*3;this.matrix[f+1][d+1]=0;f=e[0]*3;d=e[1]*3;this.matrix[f+1][d+1]=0;switch(a){case 1:this.setDirt(1,b);this.setDirt(2,e);break;case 2:this.setDirt(2,b);this.setDirt(1,e);break;case 4:this.setDirt(3,b);this.setDirt(4,e);break;case 3:this.setDirt(4,b);this.setDirt(3,e);break}},setDirt:function(a,b){var e=b[0]*3;b=b[1]*3;var f,d;switch(a){case 1:f=e+1;d=b;break;case 2:f=
e+1;d=b+2;break;case 4:f=e+2;d=b+1;break;case 3:f=e;d=b+1;break}this.matrix[f][d]=0},getDirt:function(a,b){return a[0]==b[0]?a[1]<b[1]?2:1:a[0]<b[0]?3:4},makePath:function(){for(var a=0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.path.push([a,b])},outPath:function(){for(var a in this.path)this.draw(this.path[a],3)},outPathByStep:function(){var a=this,b=0,e=setInterval(function(){a.draw(a.path[b],3);b++;b>=a.path.length&&clearInterval(e)},100)},outMatrix:function(){for(var a=
0;a<this.rows;a++)for(var b=0;b<this.columns;b++)this.matrix[a][b]==0&&this.draw([a,b],0)},makeTile:function(){for(var a=this.path.length-4,b=Equip.getTileSum(),e=0;e<b;e++){var f=Math.ceil(Math.random()*a-1);f+=2;f=this.path[f];this.matrix[f[0]][f[1]]=2}},getMatrix:function(){return this.matrix},getPath:function(){return this.path},getDisturbPath:function(){return c.getDisturbPath()},draw:function(a,b){b=[[0,0],[32,0],[64,0],[0,32],[32,32],[64,32]][b];(new Yy.TileLayer({canvas:this.canvas,img:this.img,
x:a[1]*32,y:a[0]*32,width:32,height:32,sx:b[0],sy:b[1]})).draw()}}})();(function(){Yy.config={}})();
(function(){Yy.config.tile={type:"tile",map:[],rows:15,columns:21,list:[],canvas:null,img:null,init:function(g){this.canvas=g;this.resetData();Yy.mazeMap.init(this.rows,this.columns);this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[]},initResource:function(){if(this.img)this.drawMap();else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/tile.png";this.img=g}},drawMap:function(){for(var g in this.map){var c=this.map[g];c.canvas=this.canvas;c.img=
this.img;c=new Yy.TileLayer(c);c.draw();this.list.push(c)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},removeTile:function(g,c){g-=g%32;c-=c%32;for(var a in this.list){var b=this.list[a];if(b.getX()==g&&b.getY()==c){this.list.splice(a,1);break}}},transToMap:function(){var g=Yy.mazeMap.getMatrix();g[1][0]=0;g[this.rows-2][this.columns-1]=0;for(var c in g){var a=g[c];for(var b in a)a[b]!=0&&this.map.push({imgUrl:"images/tile.png",
sx:32,sy:0,width:32,height:32,x:b*32,y:c*32})}}}})();
(function(){var g={map:{imgUrl:"images/sprite_man.png",sx:0,sy:0,width:30,height:45,step:16},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],sprite:null,canvas:null,init:function(c){this.canvas=c;this.resetData();if(!this.img){window.addEventListener("keydown",this.keydown,false);window.addEventListener("keyup",this.keyup,false)}this.initResource()},resetData:function(){this.list=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/sprite_man.png";this.img=c}},drawMap:function(){var c=this.map;c.frameImgs=this.frameImgs;c.canvas=this.canvas;c.img=this.img;this.sprite=new Yy.SpriteMan(c);this.sprite.walk("right");this.sprite.draw();this.list.push(this.sprite);this.loaded()},getList:function(){return this.list},getSprite:function(){return this.sprite},draw:function(){this.sprite.draw()},loaded:function(){Game.loadNext()},
keydown:function(c){var a=g;switch(c.keyCode){case 37:a.sprite.walk("left");break;case 38:a.sprite.walk("up");break;case 39:a.sprite.walk("right");break;case 40:a.sprite.walk("down");break;case 32:var b=a.sprite.getX()+5;y=a.sprite.getY();Yy.config.bomb.setBomb(b,y,a.sprite.getDirection());break;default:return false}Game.paintCanvas();c.stopPropagation()},keyup:function(){}};Yy.config.man=g})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.bomb={type:"weapon",map:{imgUrl:"images/sprite_bomb.png",sx:0,sy:0,width:32,height:32,step:0,x:0,y:0},frameImgs:{down:[[0,0],[30,0],[60,0],[90,0]],left:[[0,45],[30,45],[60,45],[90,45]],right:[[0,90],[30,90],[60,90],[90,90]],up:[[0,135],[30,135],[60,135],[90,135]]},list:[],canvas:null,
timer:null,img:null,init:function(c){this.canvas=c;this.resetData();this.initResource()},resetData:function(){this.list=[]},initResource:function(){if(this.img)this.loaded();else{var c=new Image,a=this;c.onload=function(){a.img=this;a.loaded()};c.src=this.map.imgUrl}},drawMap:function(){},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},loaded:function(){Game.loadNext()},setBomb:function(c,a,b){if(Equip.getBombSum()<1)return false;var e=0,f=0;switch(b){case "down":f+=
2;break;case "left":f+=1;e-=1;break;case "right":f+=1;e+=1;break}b=this.map;b.x=c-c%32+e*32;b.y=a-a%32+f*32;b.canvas=this.canvas;b.img=this.img;var d=new g(b);d.draw();this.list.push(d);var h=this;setTimeout(function(){h.doBomb(d)},500);Equip.reduceBomb();Dom.updateBomb()},doBomb:function(c){for(var a in this.list)this.list[a]==c&&this.list.splice(a,1);Yy.config.tile.removeTile(c.getX(),c.getY());Game.paintCanvas()}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipStar={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getStarSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:0,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Equip.addBomb();Dom.updateBomb()}}}}})();
(function(){function g(c){this.canvas=c.canvas;this.id=c.id;this.x=c.x||0;this.y=c.y||0;this.width=c.width||0;this.height=c.height||0;this.img=c.img||null;this.sx=c.sx||0;this.sy=c.sy||0}g.prototype=new Yy.Layer;Yy.config.equipTime={type:"equip",map:[],list:[],canvas:null,img:null,timer:null,img:null,sum:3,posArr:[],init:function(c){this.canvas=c;this.sum=Equip.getTimeSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.posArr=[];this.map=
[]},initResource:function(){if(this.img)this.drawMap();else{var c=new Image,a=this;c.onload=function(){a.drawMap()};c.src="images/tile.png";this.img=c}},makePos:function(){var c=Yy.mazeMap.getMatrix(),a=[],b=c.length;for(var e in c){var f=c[e];if(!(e<2||e>b-2)){var d=f.length;for(var h in f)h>1&&h<d-1&&f[h]==0&&a.push([e,h])}}b=a.length;for(c=this.sum<b?this.sum:b;c-- >0;){b=a.length;b=Math.ceil(Math.random()*b-1);this.posArr.push(a.splice(b,1)[0])}},transToMap:function(){for(var c in this.posArr){var a=
this.posArr[c];this.map.push({imgUrl:"images/tile.png",sx:32,sy:64,width:32,height:32,x:a[1]*32,y:a[0]*32})}},drawMap:function(){for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a=new g(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var c in this.list)this.list[c].draw()},removeEquip:function(c,a){c-=c%32;a-=a%32;for(var b in this.list){var e=this.list[b];e.getX()==c&&e.getY()==a&&this.list.splice(b,1)}},loaded:function(){Game.loadNext()},
checkHit:function(c){for(var a in this.list){var b=this.list[a].getRect();if(Yy.checkRect(c,b)){this.list.splice(a,1);Timer.addTime();Dom.updateTime(Timer.getTime())}}}}})();
(function(){Yy.config.tiger={type:"sprite",map:[],frameImgs:{down:[[0,0],[29,0],[58,0],[87,0]],left:[[0,31],[29,31],[58,31],[87,31]],right:[[0,62],[29,62],[58,62],[87,62]],up:[[0,93],[29,93],[58,93],[87,93]]},list:[],sprite:null,canvas:null,posArr:[],sum:3,autoWalkCount:0,init:function(g){this.canvas=g;this.sum=Equip.getTigerSum()||3;this.resetData();this.makePos();this.transToMap();this.initResource()},resetData:function(){this.list=[];this.map=[];this.posArr=[]},initResource:function(){if(this.img)this.drawMap();
else{var g=new Image,c=this;g.onload=function(){c.drawMap()};g.src="images/sprite_tiger.png";this.img=g}},drawMap:function(){var g=["left","right","up","down"];for(var c in this.map){var a=this.map[c];a.canvas=this.canvas;a.img=this.img;a.frameImgs=this.frameImgs;a.direction=g[Yy.getRandom(4)];a=new Yy.SpriteTiger(a);a.draw();this.list.push(a)}this.loaded()},getList:function(){return this.list},draw:function(){for(var g in this.list)this.list[g].draw()},loaded:function(){Game.loadNext()},makePos:function(){var g=
Yy.mazeMap.getMatrix(),c=[],a=g.length;for(var b in g){var e=g[b];if(!(b<2||b>a-2)){var f=e.length;for(var d in e)d>1&&d<f-1&&e[d]==0&&c.push([b,d])}}a=c.length;for(g=this.sum<a?this.sum:a;g-- >0;){a=c.length;a=Yy.getRandom(a);this.posArr.push(c.splice(a,1)[0])}},transToMap:function(){for(var g in this.posArr){var c=this.posArr[g];this.map.push({imgUrl:"images/sprite_tiger.png",sx:0,sy:0,width:29,height:31,step:3,x:c[1]*32,y:c[0]*32})}},autoWalk:function(){var g=this.list.length;if(g<1)return false;
for(var c=g>=5?g:5,a=0;a<c;a++)if(!(a>=g||a!=this.autoWalkCount)){var b=this.list[a];b.walk();b.draw()}this.autoWalkCount++;if(this.autoWalkCount>=c)this.autoWalkCount=0},getChectList:function(g){var c=[];for(var a in this.list){var b=this.list[a].getRect();g[0]<=b[2]&&g[2]>=b[0]&&g[1]<=b[3]&&g[3]>=b[1]&&c.push(this.list[a])}return c}}})();
(function(){function g(){a.init()}var c={context:document.getElementById("gameCanvas").getContext("2d"),width:document.getElementById("gameCanvas").width,height:document.getElementById("gameCanvas").height},a={passCount:0,isEnd:false,loadingNextPass:false,loadStock:[],init:function(){this.passCount++;if(this.passCount>8){this.gameAll();return false}this.clearCanvas();e.init(this.passCount);b.init();b.updatePassNumber(this.passCount);for(var d=["tile","bomb","equipStar","equipTime","tiger","man"],
h=Yy.config,i=d.length-1;i>=0;i--){var j=d[i];h[j]&&this.loadStock.push(h[j])}this.startLoad()},clearCanvas:function(){c.context.clearRect(0,0,c.width,c.height)},paintCanvas:function(){this.clearCanvas();var d=Yy.config;for(var h in d)d[h].draw()},intervalPaint:function(){var d=Yy.config;for(var h in d){var i=d[h];i.type=="sprite"&&i.autoWalk()}this.paintCanvas()},getcheckTileHitList:function(d,h,i,j){var k=[],m=Yy.config.tile.getList();for(var n in m){var l=m[n].getRect();d<=l[2]&&i>=l[0]&&h<=l[3]&&
j>=l[1]&&k.push(m[n])}return k},checkTileHit:function(d){var h=this.getcheckTileHitList(d[0],d[1],d[2],d[3]);if(h.length===0)return false;for(var i in h){var j=h[i].getRect();if(Yy.checkRect(d,j))return true}return false},checkEquip:function(d){var h=Yy.config;for(var i in h){var j=h[i];j.type=="equip"&&j.checkHit(d)}},checkSpriteHit:function(){var d=[],h=Yy.config.man.getSprite().getCheckRect(),i=Yy.config;for(var j in i){var k=i[j];if(k.type=="sprite"){k=k.getChectList(h);d=d.concat(k)}}for(j in d)if(Yy.checkRect(h,
d[j].getCheckRect())){this.spriteHit();break}},spriteHit:function(){this.gameOver()},startLoad:function(){this.loadNext()},loadNext:function(){this.loadStock.length>0?this.loadStock.pop().init(c):this.loaded()},loaded:function(){f.init();b.hideTips();this.loadingNextPass=false;Yy.timer.init();Yy.event.listen("timer_60",this.intervalPaint,this)},checkGameIsOver:function(d){if(this.loadingNextPass)return false;var h=this;if(d[0]>=c.width-32&&d[1]>=c.height-64){b.gameOver("\u606d\u559c\u8fc7\u5173\uff01\uff01");
this.loadingNextPass=true;setTimeout(function(){h.init()},1E3)}},gameOver:function(){this.isEnd=true;b.gameOver("\u6e38\u620f\u7ed3\u675f");f.clearTime()},gameAll:function(){b.tips("\u901a\u5173");this.isEnd=true;f.clearTime()},isOver:function(){return this.isEnd}};window.Game=a;var b={dom:{},init:function(){if(!this.dom.bomb){this.dom.bomb=document.getElementById("bomb_number");this.dom.tips=document.getElementById("tips");this.dom.time=document.getElementById("game_time");this.dom.next=document.getElementById("nextGame");
this.dom.pass=document.getElementById("pass_number");var d=this;this.dom.next.addEventListener("click",function(){d.onNextGame()},false)}this.dom.bomb.innerHTML=e.getBombSum();this.tips("Loading...")},updatePassNumber:function(d){this.dom.pass.innerHTML=d+"/8"},updateBomb:function(){this.dom.bomb.innerHTML=e.getBombSum()},gameOver:function(d){this.tips(d);a.clearCanvas()},tips:function(d){this.dom.tips.innerHTML=d;this.dom.tips.style.display="block"},hideTips:function(){this.dom.tips.style.display=
"none"},updateTime:function(d){this.dom.time.innerHTML=d},onNextGame:function(){a.init()}};window.Dom=b;var e={bombSum:15,tile:3,star:3,time:3,tiger:3,passEquip:[[1,1,1,1,2],[2,2,2,2,3],[3,3,3,3,3],[4,4,5,5,3],[4,4,4,4,4],[5,5,7,7,4],[5,5,6,6,4],[5,5,5,5,5]],init:function(d){if(d>this.passEquip.length)return false;d=this.passEquip[d-1];this.bombSum=d[0];this.tile=d[1];this.star=d[2];this.time=d[3];this.tiger=d[4]},getStarSum:function(){return this.star},getTimeSum:function(){return this.time},getTileSum:function(){return this.tile},
getTigerSum:function(){return this.tiger},getBombSum:function(){return this.bombSum},reduceBomb:function(){this.bombSum>0&&--this.bombSum},addBomb:function(){++this.bombSum}};window.Equip=e;var f={timer:null,time:60,init:function(){this.time=60;this.timer&&clearInterval(this.timer);this.start()},start:function(){var d=this;this.timer=setInterval(function(){d.time>=0?b.updateTime(d.time--):a.gameOver()},1E3)},addTime:function(){this.time+=60},getTime:function(){return this.time},clearTime:function(){clearInterval(this.timer)}};
window.Timer=f;g()})();
